[
  {
    "op": "add",
    "path": "/steps/3",
    "value": {
      "id": "tenantx-ml-screening",
      "kind": "action",
      "title_i18n": {
        "en-IE": "Machine learning screening (Tenant X)"
      },
      "execution": {
        "mode": "temporal",
        "workflow": "tenantX.mlScreening",
        "taskQueue": "tenant-x-main",
        "input_schema": "schemas/ml-screening.json",
        "permissions": ["org:member"],
        "secret_aliases": ["secrets.mlApiKey"]
      },
      "verify": [
        { "rule": "ml_screening_passed" }
      ]
    }
  },
  {
    "op": "replace",
    "path": "/steps/4/requires",
    "value": ["tenantx-ml-screening"]
  },
  {
    "op": "add",
    "path": "/steps/7",
    "value": {
      "id": "tenantx-policy-attest",
      "kind": "action",
      "title_i18n": {
        "en-IE": "Board policy attestation (Tenant X)"
      },
      "execution": {
        "mode": "manual",
        "input_schema": "schemas/policy-attest.json",
        "permissions": ["org:member"]
      },
      "requires": ["rbo"],
      "verify": [
        { "rule": "board_policy_signed" }
      ]
    }
  },
  {
    "op": "add",
    "path": "/steps/-",
    "value": {
      "id": "tenantx-sysy-enrichment",
      "kind": "action",
      "title_i18n": {
        "en-IE": "System Y enrichment job"
      },
      "description_i18n": {
        "en-IE": "Launches the System Y data enrichment job and waits for the secure callback or polling confirmation."
      },
      "stepType": "external-job-with-callback@1.0.0",
      "execution": {
        "mode": "temporal",
        "workflow": "externalJobWorkflow",
        "config": {
          "workflow": "externalJobWorkflow",
          "externalRefPath": "body.ticketId",
          "egress": {
            "method": "POST",
            "urlAlias": "secrets.sysY.baseUrl",
            "tokenAlias": "secrets.sysY.apiToken",
            "path": "/v1/enrich",
            "headers": {
              "X-SystemY-Tenant": "tenant-x"
            },
            "signingSecretAlias": "secrets.sysY.egress"
          },
          "ingress": {
            "timeoutSeconds": 900,
            "escalateReason": "ingress_timeout"
          },
          "polling": {
            "enabled": true,
            "intervalSeconds": 30,
            "maxAttempts": 40,
            "statusPath": "/v1/jobs/{{ticketId}}",
            "successWhen": {
              "path": "body.status",
              "equals": "complete"
            },
            "failureWhen": {
              "path": "body.status",
              "in": ["failed", "cancelled"]
            }
          },
          "notesOnSuccess": "System Y enrichment completed",
          "notesOnFailure": "System Y enrichment requires manual review"
        }
      },
      "requires": ["tenantx-ml-screening"],
      "verify": [
        { "rule": "sysy_enrichment_complete" }
      ]
    }
  },
  {
    "op": "replace",
    "path": "/steps/8/requires",
    "value": ["tenantx-policy-attest"]
  }
]
